"use strict";require("dotenv").config();var logger=require("morgan"),bodyParser=require("body-parser"),cookieParser=require("cookie-parser"),express=require("express"),cors=require("cors"),app=express(),path=require("path"),requestIp=require("request-ip"),geoip=require("geoip-country"),port=process.env.PORT||9900,myApi=require("./api.js"),corsOptions={origin:"https://jin827.github.io",optionsSuccessStatus:200};app.use(cors(corsOptions)),app.use(logger("dev")),app.use(bodyParser.urlencoded({extended:!0})),app.use(bodyParser.json()),app.use(cookieParser());var SUPPORTED_LANGUAGES={en:1,kr:1};app.get("/",function(e,s,r){if(e._lang=e.query.lang||e.cookies.lang,SUPPORTED_LANGUAGES[e._lang]?s.cookie("lang",e._lang):e._lang="en",e.query.lang)return s.redirect("/");r()}),app.use(requestIp.mw()),app.use(function(e,s,r){e.clientIp;e.geo=geoip.lookup("1.11.255.255"),r()}),"production"===app.get("env")?app.get("/",function(e,s){s.redirect("https://jin827.github.io/index-"+e._lang+".html")}):(app.use("/vendors",express.static(process.cwd()+"/vendors")),app.use("/resources",express.static(path.join(__dirname,"../","client/resources"))),app.use(express.static(process.cwd()+"/static")),app.get("/kr",function(e,s){s.sendFile(path.join(__dirname,"/views/kr/index.html"))}),app.get("/en",function(e,s){s.sendFile(path.join(__dirname,"/views/en/index.html"))}),app.get("/index.html",function(e,s){s.sendFile(path.join(__dirname,"/views/index.html"))}),app.get("/",function(e,s){s.sendFile(path.join(__dirname,"/views/"+e._lang+"/index.html"))})),app.post("/api/contact",function(e,s){return myApi.sendEmail(e.body).then(function(){return myApi.replyEmail(e.body)}).then(function(){return s.status(201).send("Email Sent Successfully!")}).catch(function(e){s.status(400).json(e)})}),app.use(function(e,s,r,n){new Error("Not Found"),e.status=404,n(e)}),"production"===app.get("env")?app.use(function(e,s,r,n){r.status(e.status||500),r.json({message:"An error has occured",error:{}}),n()}):app.use(function(e,s,r,n){r.status(e.status||500),r.json({message:e.message,error:e}),n()}),app.listen(port,function(){});
//# sourceMappingURL=maps/index.js.map
